<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Chapter 1 - The SuperCollider Cookbook</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="chapter_1.html" class="active"><strong aria-hidden="true">1.</strong> Chapter 1</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">The SuperCollider Cookbook</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <p>#Chapter 1 Debugging techniques
In a perfect world every line of code you type in immediately works as expected.  If you are like
most people, however, you will make tons of mistakes. SuperCollider does not have a built-in
debugger. So how do we go about debugging problems? We'll go over some ways to debug your
SuperCollider programs.</p>
<h2 id="printing-techniques"><a class="header" href="#printing-techniques">Printing techniques</a></h2>
<h3 id="printing-content-of-variables"><a class="header" href="#printing-content-of-variables">Printing content of variables</a></h3>
<p>SuperCollider offers a few method calls to post information to the post window.  The most common
used ones are <code>postln</code>, <code>postcs</code> and <code>debug</code>.</p>
<ul>
<li><code>postln</code> prints the value of the variable in the post window and automatically adds a newline.
<code>post</code> does the same but without adding a newline</li>
<li><code>postcs</code> prints the value in the form of a compile string in the post window and also adds a newline</li>
<li><code>debug</code> takes an argument and uses it as prefix when printing the value</li>
</ul>
<p>Some examples to make it clear</p>
<pre><code class="language-supercollider">(
var num = 42;
var txt = "important message";
txt.postln; // important message
num.postln; // 42
txt.postcs; // "important message" (note the additional quotes)
num.postcs; // 42 (note no additional quotes) 
txt.debug("text"); // text: important message
)
</code></pre>
<p>From the examples you can already understand where <code>postcs</code> can be useful: one common type of bug is
using a string where you expect a number (or vice versa).  by using <code>postcs</code> the difference is
immediately visible.</p>
<h3 id="printing-type-of-a-variable"><a class="header" href="#printing-type-of-a-variable">Printing type of a variable</a></h3>
<p>Sometimes you want to see more detailed information about the exact type of a variable.  In that
case you can <code>postln</code> its class.</p>
<pre><code class="language-supercollider">(
var pat = Pbind(\instrument, \default);
var player = pat.play;
pat.class.postln; // Pbind
fork {
    player.class.postln; // EventStreamPlayer
    3.wait;
    player.stop;
}
)
</code></pre>
<h3 id="printing-intermediate-results-in-complex-expressions"><a class="header" href="#printing-intermediate-results-in-complex-expressions">Printing intermediate results in complex expressions</a></h3>
<p>Supercollider forces you to declare your variables at the top of the function definition.
Sometimes this can be annoying if you want to quickly inspect the values of some variables
before some later calculations, because it forces you to rewrite your code.</p>
<p>A cool feature of print methods like <code>postln</code>, <code>postcs</code> and <code>debug</code> is the fact that they return the
object they work on after printing it to the post window.</p>
<p>Suppose we want to debug the following code</p>
<pre><code class="language-supercollider">(
var one = 1;
var two = "2";
var division = one/two;
var double = division*2;
division.debug("division");
)
</code></pre>
<p>The division.debug will never be executed, because the initialization of division in the line before
already crashes. If you want to examine the values of <code>one</code> and <code>two</code> before the division happens,
you could refactor your code to separate the declaration of division from its initialization.
The more complex the code becomes, the more work this takes.</p>
<pre><code class="language-supercollider">(
var one = 1;
var two = "2";
var division;
var double;
one.postcs;
two.postcs;
division = one/two;
division.debug("division");
double = division*2;
)
</code></pre>
<p>Because the post and debug family of calls return the object they operate on, you can often avoid rewriting
your code just for debugging purposes.</p>
<pre><code class="language-supercollider">(
var one = 1;
var two = "2";
var division = one.postcs/two.postcs;
var double = division*2;
division.debug("division");
)
</code></pre>
<p><em>Spoiler: The problem in the code is that you're trying to divide a number by a string.</em></p>
<h3 id="concatenating-messages"><a class="header" href="#concatenating-messages">Concatenating messages</a></h3>
<p>A final family of techniques that can be useful to know in the context of debugging are some different approaches
to concatenating strings to form a longer, more informative line of text.</p>
<ul>
<li>The operator <code>++</code> concatenates representations of objects without space. To get a string as result of the concatenation,
the left hand side of a ++ expression must be a string.</li>
<li>The operator <code>+</code> concatenates representations of objects and automatically adds a space in between. Either left hand
side or right hand side has to be a string.</li>
</ul>
<pre><code class="language-supercollider">(
var t1 = "txt";
var t2 = "another one";
var n1 = 2.0;
var n2 = 3.0;
(t1 ++ t2).postcs; // "txtanother one"
(t1 + n1).postcs; // "txt 2.0"
//(n1 ++ t1).postcs; // ERROR: Message '++' not understood
(n1 + t1).postcs; // "2.0 txt"
(n1 + n2).postcs; // 5.0
("" ++ n1 + n2).postcs; // "2.0 3.0"
)
</code></pre>
<p>Notice the use of brackets. If you forget them, as in <code>t1 ++ t2.postcs</code> you only print the value of
t2.</p>
<p>Another approach to make longer strings is by using a call to <code>format</code>. The following is an example:</p>
<pre><code class="language-supercollider">(
var n1=2;
var n2=3;
"if you add % to % you get %".format(n1, n2, n1+n2).postln;
)
</code></pre>
<p>In these strings, the percentage character (%) is used as a placeholder, to be replaced with a
value.  If you need to print a percentage character, use \\% instead.</p>
<h1 id="debugging-patterns"><a class="header" href="#debugging-patterns">Debugging patterns</a></h1>
<h2 id="printing-values-produced-by-patterns"><a class="header" href="#printing-values-produced-by-patterns">Printing values produced by patterns</a></h2>
<p>A neat trick to monitor which values your patterns are producing for certain keys is calling
<code>trace</code>.  <code>trace</code> prints out these values to the post window. Example: why don't the pat1 rhythms
sound as random as those produced by pat2?</p>
<p>Compare the output of the duration pattern in the following two code fragments:</p>
<pre><code class="language-supercollider">(
s.waitForBoot({
    var pat1 = Pbind(
        \instrument, \default,
        \dur, Pwhite(0,1,inf).trace,
        \midinote, Pbrown(40,70,1,inf)
    );
    ~player = pat1.play;
});
)

// output: 
1 
0 
1 
0 
1 
1 
...
</code></pre>
<p>versus</p>
<pre><code class="language-supercollider">(
s.waitForBoot({
    var pat2 = Pbind(
        \instrument, \default,
        \dur, Pwhite(0.0,1.0,inf).trace,
        \midinote, Pbrown(40,70,1,inf)
    );
    ~player = pat2.play;
});
)

// output:
0.01384711265564 
0.56002390384674 
0.79622256755829 
...
</code></pre>
<p><code>trace</code> can be used on any pattern, so you could just as well write the following to observe all
values produced by the pattern</p>
<pre><code class="language-supercollider">(
s.waitForBoot({
    var pat1 = Pbind(
        \instrument, \default,
        \dur, Pwhite(0,1,inf),
        \midinote, Pbrown(40,70,1,inf)
    );
    ~player = pat1.trace.play;
});
)

// output:

( 'instrument': default, 'dur': 1, 'midinote': 43 ) 
( 'instrument': default, 'dur': 0, 'midinote': 44 ) 
...
</code></pre>
<h2 id="customized-debug-messages"><a class="header" href="#customized-debug-messages">Customized debug messages</a></h2>
<p>If you need more flexibility in how to represent the values, you can add an extra key in the
pattern.  One property of patterns is that every key you add to them is evaluated when it's time to
produce a new event. By using Pfunc, you get access to all the keys specified before the extra key
in the pattern.</p>
<p>In the following example, we add the key \myfunnykey. Note that this key has no predefined meaning,
but like any other key it is evaluated when it's time to produce a new event. The Pfunc pattern
takes an event as argument. Via this event argument you can access the values of the keys
\instrument and \dur  which are specified before \myfunnykey in the pattern.</p>
<p>In the example, the value of \midinote is not yet known when \myfunnykey is evaluated because it
is specified after \myfunnykey, and therefore we cannot print it. If you move \myfunnykey to the
very bottom of the Pbind specification, you'd be able to print the value of \midinote as well.</p>
<pre><code class="language-supercollider">(
s.waitForBoot({
    var pat1 = Pbind(
        \instrument, \default,
        \dur, Pwhite(0.0,1.0,inf),
        \myfunnykey, Pfunc({
            | event |
            "The pattern produces a duration of % with instrument %".format(event[\dur], event[\instrument]).postln;
            "midi note is set to % (this should be wrong because midinote is not known yet)".format(event[\midinote]).postln;
        }),
        \midinote, Pbrown(40,70,1,inf)
    );
    ~player = pat1.play;
});
)

//output: 

The pattern produces a duration of 0.782435297966 with instrument default
midi note is set to a Function (this should be wrong because midinote is not known yet)
The pattern produces a duration of 0.40264010429382 with instrument default
midi note is set to a Function (this should be wrong because midinote is not known yet)
...
</code></pre>
<p>Try to move \midinote before \myfunnykey in the previous example and observe the difference in
output.</p>
<p><em>Tip: The same mechanism that is used here to produce custom debugging messages can also be used to
build real-time visualizations of patterns while they are playing. Instead of printing messages to
the post window, one then updates elements in a user interface. One example of such a system can be
found on <a href="http://sccode.org/1-56u">sccode.org</a></em></p>
<h1 id="debugging-ugens"><a class="header" href="#debugging-ugens">Debugging UGens</a></h1>
<h2 id="printing-values-produced-by-ugens"><a class="header" href="#printing-values-produced-by-ugens">Printing values produced by UGens</a></h2>
<p>A low-tech, but useful operation is to print out values produced by some UGen. As UGens typically
run on the server, and printing is something that happens in the language, you might expect we'll
need some mechanism to transfer data from the server to the language. You would be right, but
SuperCollider UGens implement a convencience method <code>poll</code> that hides all of this complexity.</p>
<p>Example:</p>
<pre><code class="language-supercollider">(
s.waitForBoot({

    // specify what a wobble looks like
    SynthDef(\wobble, {
        var out=\out.kr(0), freq=\freq.kr(440), amp=\amp.kr(0.1);
        var env = EnvGen.ar(Env.perc(0.01, 2.0), doneAction:Done.freeSelf);
        var sig = amp*env*SinOsc.ar(3).range(0.5,1)*SinOsc.ar(freq);
        Out.ar(out, sig!2);
    }).add;
    
    // make sure the synth has arrived on the server before continuing
    s.sync;
    
    // play a wobble
    Synth(\wobble); 
});
)
</code></pre>
<p>Imagine you want to examine in more detail why wobble wobbles. The call to <code>range(0.5,1)</code> catches your
attention, and you are curious what values it produces.  By using <code>poll</code>, its value will be printed to
the post window at regular intervals:</p>
<pre><code class="language-supercollider">(
s.waitForBoot({

    // specify what a wobble looks like
    SynthDef(\wobble, {
        var out = \out.kr(0), freq = \freq.kr(440), amp = \amp.kr(0.1);
        var env = EnvGen.ar(Env.perc(0.01, 2.0), doneAction:Done.freeSelf);
        var sig = amp*env*SinOsc.ar(3).range(0.5,1).poll*SinOsc.ar(freq);
        Out.ar(out, sig!2);
    }).add;
    
    // make sure the synth has arrived on the server before continuing
    s.sync;
    
    // play a wobble
    Synth(\wobble); 
});
)

// output:
UGen(MulAdd): 0.750098
UGen(MulAdd): 0.987736
UGen(MulAdd): 0.602984
UGen(MulAdd): 0.603118
</code></pre>
<p>Note that as written above, you only see the output of <code>SinOsc.ar(3).range(0.5,1)</code> but not of other
stuff surrounding it.  If you want to see the output of - say - <code>amp*env*SinOsc.ar(3)*range(0.5,1)</code>
instead, you could slightly restructure your code as in the following example.</p>
<pre><code class="language-supercollider">(
s.waitForBoot({

    SynthDef(\wobble, {
        var out = \out.kr(0), freq = \freq.kr(440), amp = \amp.kr(0.1);
        var env = EnvGen.ar(Env.perc(0.01, 2.0), doneAction:Done.freeSelf);
        var partialsignal = amp*env*SinOsc.ar(3).range(0.5,1);
        var sig = partialsignal.poll*SinOsc.ar(freq);
        Out.ar(out, sig!2);
    }).add;

    s.sync;

    Synth(\wobble);
});
)

// output:
UGen(BinaryOpUGen): 0.000635417
UGen(BinaryOpUGen): 0.082192
UGen(BinaryOpUGen): 0.0408766
UGen(BinaryOpUGen): 0.0332704
</code></pre>
<p>Calling <code>poll</code> will print new values with a predefined frequency. If you want more flexibility you
can pass in some arguments. In the following example, the values are printed 30 times per second
(everytime the first argument produces a pulse) with a prefix "my funky msg".</p>
<pre><code class="language-supercollider">(
s.waitForBoot({
    SynthDef(\wobble, {
        var out = \out.kr(0), freq = \freq.kr(440), amp = \amp.kr(0.1);
        var env = EnvGen.ar(Env.perc(0.01, 2.0), doneAction:Done.freeSelf);
        var partialsignal = SinOsc.ar(3).range(0.5,1);
        var sig = amp*env*partialsignal.poll(Impulse.ar(30), "my funky msg")*SinOsc.ar(freq);
        Out.ar(out, sig!2);
    }).add;
    
    s.sync;
    
    Synth(\wobble);
});
)

// output:
my funky msg: 0.750098
my funky msg: 0.897103
my funky msg: 0.987823
my funky msg: 0.987705
</code></pre>
<p><em>Tip: Other ways exist to send data from the server to the language, which allow greater flexibility
in what to do with it (like building custom graphical visualizations) but they would lead us a bit
too far in the context of debugging. If you can't wait to learn about these other ways to
communicate data from server to language, you can research some <a href="http://modularbrains.net/dx490a/DX490A_su2010_02.1_%5BServer-language_communication%5D.html">examples from a course given by
Stelios Manousakis</a>.
One of these alternative mechanisms sends data over a bus. This also happens to be the mechanism
underlying the next topic.</em></p>
<h2 id="visualizing-ugen-output-with-a-freqscope"><a class="header" href="#visualizing-ugen-output-with-a-freqscope">Visualizing UGen output with a FreqScope</a></h2>
<p>FreqScope is another way to observe output created by a UGen. It monitors data posted on a Bus and
visualizes it on an oscilloscope. Because it looks at a bus, it remains completely decoupled from
the UGen that produces the data.</p>
<p>In the following example, the \sine UGen posts data on output bus 0 and FreqScope observes output
bus 0.</p>
<pre><code class="language-supercollider">(
s.waitForBoot({
    SynthDef(\sine, {
        var out = \out.kr(0), freq = \freq.kr(440), amp = \amp.kr(0.1);
        var env = EnvGen.ar(Env.perc(0.01, 5.0), doneAction:Done.freeSelf);
        var partialsignal = SinOsc.ar(3).range(0.5,1);
        var sig = amp*env*partialsignal.poll(Impulse.ar(30), "my funky msg")*SinOsc.ar(freq);
        Out.ar(out, sig!2);
    }).add;

    s.sync;

    // create a new analyzer
    FreqScope.new(400, 200, 0, server: s);

    // play sine
    Synth(\sine).play;
});
)
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
